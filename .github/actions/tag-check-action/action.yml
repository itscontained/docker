name: 'Tag Check Action'
description: 'A Github Action see if the tag supplied already exists on dockerhub'
inputs:
  image:
    description: "Image to check"
    required: true
  tag:
    description: "Tag to check"
    required: true
outputs:
  tag:
    description: "Return the matching tag, if any"
    value: ${{ steps.check-tag.outputs.tag }}
runs:
  using: "composite"
  steps:
    - name: Check Upstream Tag Against DockerHub Registry
      id: check-tag
      shell: bash
      env:
        VERSION: ${{ inputs.tag }}
      run: |
        echo "🔍 Checking ${{ inputs.image }} for a tag that matches ${{ inputs.tag }}"
        TAG="$(curl -s https://registry.hub.docker.com/v1/repositories/${{ inputs.image }}/tags | jq -r '.[] | select(.name==env.VERSION) | .name')"
        if [[ -n "$TAG" ]]
        then
          echo "🎉 Match found! - ${{ inputs.image }}:{{ inputs.tag }}"
          echo "::set-output name=tag::${{ inputs.tag }}"
        else
          echo "❌ Could not find a tag matching ${{ inputs.tag }} for ${{ inputs.image }}"
        fi

